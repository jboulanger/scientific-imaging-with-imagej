%\documentclass[9pt,twocolumn,colorlinks=true,linkcolor=black,urlcolor=skyblue1,a4paper]{scrartcl}
%\usepackage{beamerarticle}
%\documentclass[ignorenonframetext]{beamer}
%\usepackage{xltxtra}
%\usepackage{amssymb, amsmath, mathtools, amsthm}
%\usepackage{fontspec}
%\usepackage{xunicode}
%\defaultfontfeatures{Mapping=tex-text}

%\setmainfont{Ubuntu} % Main document font
\definecolor{skyblue1}{RGB}{114,159,207}
\definecolor{plum1}{RGB}{173,127,168}
\definecolor{chameleon1}{RGB}{78,154,6}
\definecolor{chocolate1}{RGB}{193,125,17}
\definecolor{comments}{RGB}{78,154,6}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}



\mode<presentation> {
  \usetheme{Pittsburgh}
  \setbeamercolor{normal text}{fg=black!60!white}
  \setbeamercolor{framesubtitle}{fg=black!50!white}
  \setbeamercolor{title}{fg=plum1}
  %\setbeamercolor{block title example}{fg=chocolate1}
  \setbeamercolor{structure}{fg=skyblue1}
  \beamertemplateshadingbackground{black!20!white}{white}
  \usefonttheme{structurebold}
  \beamertemplatenavigationsymbolsempty
  \setbeamertemplate{footline}[frame number]
  \defbeamertemplate*{title page}{customized}[1][] {
    \flushright
    \usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par
    \usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par
    \bigskip
    \usebeamerfont{author}\usebeamercolor[fg]{normal text}\insertauthor\par
    \usebeamerfont{institute}\insertinstitute\par
    \usebeamerfont{date}\insertdate\par
    \usebeamercolor[fg]{titlegraphic}\inserttitlegraphic
  }
}


\usepackage{hyperref}

\usepackage{listings}
\lstset{ backgroundcolor=\color{yellow!10!white}, basicstyle=\footnotesize,
  breakatwhitespace=false, breaklines=true,
  captionpos=t, commentstyle=\color{comments},
  deletekeywords={...}, escapeinside={\%*}{*)},
  extendedchars=true, frame=none,
  keepspaces=true, keywordstyle=\color{blue},
  language=Java, otherkeywords={macro,function},
  numbers=none, numbersep=5pt,  numberstyle=\tiny\color{mygray},
  rulecolor=\color{black},  showspaces=false, showstringspaces=false,
  showtabs=false,  stepnumber=2,  stringstyle=\color{mymauve},
  tabsize=2,  title=\lstname, abovecaptionskip=0cm,belowcaptionskip=0cm
}

\only<presentation>{\lstset{basicstyle=\tiny}}

\usepackage{menukeys}

%\usepackage[backend=biber]{biblatex}
%\addbibresource{references.bib}
%\renewbibmacro{in:}{}   % remove In
%\renewbibmacro{title}{} % remove title

%\newrobustcmd*{\footfullcitenomark}{%
%  \AtNextCite{%
%    \let\thefootnote\relax
%    \let\mkbibfootnote\mkbibfootnotetext}%
%  \footfullcite}

\usepackage{tikz,pgfplots}
\usetikzlibrary{calc,shapes,positioning}

\newcommand{\kw}[1]{\textcolor{orange}{\textbf{#1}}}
\newcommand{\code}[1] {\textcolor{gray}{\texttt{#1}}}
\usepackage{graphicx}
\graphicspath{{figs/}}

%\newtheorem{example}{Example:}

\setcounter{tocdepth}{1}
\title{Scientific Imaging with ImageJ}
\author{J\'er\^ome Boulanger}
\date{}
\begin{document}
\begin{frame}
  \maketitle
\end{frame}

\begin{frame}<presentation>
  %\mode<presentation>{\frametitle{Outline}}
  %\tiny \tableofcontents
  Stack hyperstack, Colors, Lookup table,

\end{frame}

\section{Introduction}


\begin{frame}
  \frametitle<presentation>{Introduction}
  The aim of this \only<presentation>{lecture}\only<article>{document} is to
  \begin{itemize}
  \item discover ImageJ
  \item understand core concepts about images
  \item improve handling of scientific images for quantification and illustation
  \end{itemize}
  Where to get help?
  \begin{itemize}
  \item \url{http://imagej.nih.gov}
  \item \url{https://imagej.net}
  \end{itemize}
\end{frame}

You will find a detailed reference on ImageJ built-in macro function
\href{http://rsb.info.nih.gov/ij/developer/macro/functions.html}{here}. In
several places of this document you will find direct entry to sections
of this page.

\begin{frame}
  \frametitle{Presentation}

  \begin{center}
    \includegraphics[width=0.5\textwidth]{ij}
  \end{center}

  \begin{itemize}
  \item ImageJ is a Java based image processing software
  \item Can run on many operating system (Microsoft Windows, Mac OS, Linux, \dots)
  \item Developed by Wayne Rasband since 1997 at the National Institute of Health
  \item ImageJ eco-system
    \begin{itemize}
      \item ImageJ2: rewrite of ImageJ for multi dimensional data
      \item Fiji: image processing package built around ImageJ2
    \end{itemize}
  \end{itemize}
  %\footfullcitenomark{ij2}
\end{frame}

\begin{frame}
  \frametitle{Installation \& Updating}
  \begin{block}{First Installation}
    \begin{itemize}
    \item Download Fiji from \url{https://imagej.net/software/fiji/downloads}
    \item Unzip and save somewhere on your hard drive where default users have access (not in ``Program Files'')
    \item In Windows open the folder and double ckick on ImageJ-win64 and create a shortcut (pin to task bar).
    \end{itemize}
  \end{block}
  \begin{block}{Updating}
    \begin{itemize}
    \item To update ImageJ to the latest version \menu{Help > Update ImageJ}.
    \item To install/update plugins collections and manage update sites \menu{Help > Update}
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{What is an image?}
  \begin{columns}
    \begin{column}{.6\textwidth}
      \begin{itemize}
      \item Sensors converts the number of detected photo-electrons into an
        electric current
      \item This current is then digitized into a number
      \item The image can be seen as an array of values with columns $x$ and rows $y$ starting at the top left corner at $(0,0)$.
      \end{itemize}
      \begin{block}{Try it yourself}
      \begin{itemize}
      \item Open a sample image : \menu{File>Open Sample>Blobs}
      \item Click on the \textcolor{red}{\texttt{>>}} icon and tick \menu{Pixel Inspector}
      \item Look at the
      \end{itemize}
    \end{block}
  \end{column}
    \begin{column}{.4\textwidth}

        \only<1>{
          \begin{tikzpicture}
            \begin{axis}[name=plot1,width=5.5cm,height=4.45cm,axis on top,
              enlargelimits=false, y dir = reverse, xlabel=x,ylabel=y]
              \addplot graphics[xmin=00,xmax=600,ymin=500,ymax=0] {array_img};
              \draw[red,very thick]  (axis cs:178,231) rectangle (axis cs:202,255);
            \end{axis}
          \end{tikzpicture}
        }
        \only<2>{\includegraphics[width=\textwidth]{array_pixels}}


    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{General image formats}
  \begin{columns}
    \begin{column}{0.75\textwidth}
      \begin{itemize}
      \item Digital images can be saved from the memory of a computer to
        its drive as files with various formats:
      \item Most file formats include some sort of compression (useless to zip them):
        \begin{itemize}
        \item Lossless compression (PNG): original values can be exactly retreived
        \item Lossy compression (JPEG): information is lost when storing the image
        \item Both (TIF): some formats are containers which can include various type of compression
        \end{itemize}
      \item ImageJ can read and write natively TIF, PNG, JPG
      \item Use TIF for saving intermediate results (with LZW compression) and PNG for figures
      \end{itemize}
    \end{column}
    \begin{column}{0.25\textwidth}
      \includegraphics[width=\textwidth]{drive}
    \end{column}
  \end{columns}

\end{frame}

\begin{frame}
  \frametitle{Microscope vendor image formats}
  Each microscopy company has developed a format that can store
  multiple series with each a multi-channel multi-plane image stack.
  \begin{itemize}
  \item Zeiss
    \begin{itemize}
    \item LSM : TIF based file format with additional metadata and LZW compression
    \item CZI : JPEG-XR and Zstd lossless compressed image
    \end{itemize}
  \item Nikon
    \begin{itemize}
    \item ND2 : JPEG-2000 lossless compression
    \end{itemize}
  \item Leica
    \begin{itemize}
    \item LIF : Customized TIF file format
    \end{itemize}
  \item Olympus
    \begin{itemize}
    \item OIF: multi file formats with associated images in a folder
    \item OIB: store multiple OIF and dependent image in one file
    \end{itemize}

  \end{itemize}
  Some standardized image format have also been developed to increase inter-operability:
  \begin{itemize}
  \item OME-TIFF, ICS, HDF5
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Loading an Image}
  \begin{itemize}
  \item Fiji will detect supported file format when selecting
    \menu{File>Open} and use bioformat if needed to load an image from disk to memory.
    \item You can also use directly the \menu{Plugins > Bio-Formats} menu to use bioformat
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Quantization}
  \begin{columns}
    \begin{column}{0.75\textwidth}
      \begin{itemize}
      \item The intensity values are quantized into grey levels

      \item Images are saved as 8-bit or 16-bit images on acquisition softwares.
      %\item For camera sensor (CCD, CMOS), photo-electron are accumulated in wells and converted into analogue voltages that are then digitized. Well depth is in the order of ~40000 electrons.
      %\item On confocal microscope, photo-multiplier tubes collect electrons and amplify them using a ch of dynodes enabling to count individual photons.
      \end{itemize}
      \begin{itemize}
      \item Use \menu{Image>Type>8-bit} to check \& convert an image to 8-bit, using the current dynamic range.
      \end{itemize}
    \end{column}
    \begin{column}{0.25\textwidth}
      \begin{center} \small
        \rowcolors{1}{blue!25!bg}{white!25!bg}
        \begin{tabular}{cc}
          bit depth & dynamic range \\ \hline
          8  & 0-255 \\
          12 & 0-4095\\
          14 & 0-16383\\
          16 & 0-65535
        \end{tabular}
      \end{center}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Brightness \& Contrast adjustment}
  \begin{itemize}
  \item \menu{Image > Adjust > Brightness \& Contrast...} or \keys{\Alt+\shift+C} launches the B\&C tool
  \item Pixels intensities are mapped linearly to the displayed intensity.
  \item Enable to discard unused part of the dynamic range
  \item Adjust the Minimum and Maximum of the dynamic range which will be displayed.
  \item Adjust the Brightness and Contrast to change how they are display.
  \item Press \menu{Auto} to enchance contrast between a predefined percentage of saturated pixels. Equivalent to \menu{Process > Enhance Contrast...} with the normalized option left unticked.
  \item Press \menu{Apply} to change the pixel values.
  \item When changing the image mode (16-bit to 8-bit or 32-bit to
    8-bit) the B\&C settings are applied to the image.
  \end{itemize}
\end{frame}



\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "slides"
%%% End:
