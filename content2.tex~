\documentclass[ignorenonframetext,aspectratio=169,10pt,xcolor=table]{beamer}
\title{Scientific Imaging with ImageJ}
\author{J\'er\^ome Boulanger}
\date{June 23rd, 2022}

\begin{document}

\begin{frame}
  \maketitle
\end{frame}

\begin{frame}<presentation>
  %\mode<presentation>{\frametitle{Outline}}
  %\tiny \tableofcontents
  Stack hyperstack, Colors, Lookup table,

\end{frame}

\section{Introduction}


\begin{frame}
  \frametitle<presentation>{Introduction}
  The aim of this \only<presentation>{lecture}\only<article>{document} is to
  \begin{itemize}
  \item improve handling of scientific images for quantification and illustation
  \item understand core concepts about images
  \item discover ImageJ
  \end{itemize}
  Where to get help?
  \begin{itemize}
  \item \url{http://imagej.nih.gov}
  \item \url{https://imagej.net}
  \item \url{https://forum.image.sc}
  \end{itemize}
\end{frame}

You will find a detailed reference on ImageJ built-in macro function
\href{http://rsb.info.nih.gov/ij/developer/macro/functions.html}{here}. In
several places of this document you will find direct entry to sections
of this page.

\begin{frame}
  \frametitle{The ImageJ software}

  \begin{center}
    \includegraphics[width=0.5\textwidth]{ij}
  \end{center}

  \begin{itemize}
  \item ImageJ is a Java based image processing software.
  \item Java programs run on the java virtual machine (virtual computer)\footnote{JRE: package to run java programs, JVM: interpret java instructions, JDK: tools to develop and run java programs}.
  \item Can run on many operating system (Microsoft Windows, Mac OS, Linux, \dots)
  \item Developed by Wayne Rasband since 1997 at the National Institute of Health
  \item ImageJ eco-system
    \begin{itemize}
      \item ImageJ2: rewrite of ImageJ for multi dimensional data
      \item Fiji: image processing package built around ImageJ2
    \end{itemize}
  \end{itemize}
  \footfullcitenomark{ij2}
\end{frame}

\begin{frame}
  \frametitle{Installation \& Updating}
  \begin{block}{First Installation}
    \begin{itemize}
    \item Download Fiji from \url{https://imagej.net/software/fiji/downloads}
    \item Unzip and save somewhere on your hard drive where default users have access (not in ``Program Files'')
    \item In Windows open the folder and double ckick on ImageJ-win64 and create a shortcut (pin to task bar).
    \end{itemize}
  \end{block}
  \begin{block}{Updating}
    \begin{itemize}
    \item To update ImageJ to the latest version \menu{Help > Update ImageJ}.
    \item To install/update plugins collections and manage update sites \menu{Help > Update}
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Fiji.app folder content}
  The Fiji.app folder is organized into several subfolders:
  \begin{itemize}
  \item \directory{jars} : contains the main jar (eg ij-1.53q.jar) and extra java dependencies
  \item \directory{macros} : contains macros you installed and the \texttt{StartupMacros.fiji.ijm}
  \item \directory{plugins}: contains the jar (java artifacts) of the plugins
  \item \directory{scripts}: contains a few matlab scripts
  \item \directory{lut} : look up tables (mapping for intensity to displayed colors)
  \end{itemize}
\end{frame}



\begin{frame}
  \frametitle{Image is data}
  \begin{columns}
    \begin{column}{.6\textwidth}
      \begin{itemize}
      \item Sensors converts the number of detected photo-electrons into an
        electric volatage
      \item This voltage is then digitized into a number by the A/D converted.
      \item The image can be seen as an array of values with columns $x$ and rows $y$ starting at the top left corner at $(0,0)$.
      \end{itemize}
      \begin{block}{Try it yourself}
      \begin{itemize}
      \item Open a sample image : \menu{File>Open Sample>Blobs}
      \item Click on the \textcolor{red}{\texttt{>>}} icon and tick \menu{Pixel Inspector}
      \end{itemize}
    \end{block}
  \end{column}
    \begin{column}{.4\textwidth}

        \only<1>{
          \begin{tikzpicture}
            \begin{axis}[name=plot1,width=5.5cm,height=4.45cm,axis on top,
              enlargelimits=false, y dir = reverse, xlabel=x,ylabel=y]
              \addplot graphics[xmin=00,xmax=600,ymin=500,ymax=0] {array_img};
              \draw[red,very thick]  (axis cs:178,231) rectangle (axis cs:202,255);
            \end{axis}
          \end{tikzpicture}
        }
        \only<2>{\includegraphics[width=\textwidth]{array_pixels}}


    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{General image formats}
  \begin{columns}
    \begin{column}{0.75\textwidth}
      \begin{itemize}
      \item Digital images can be saved from the volatile memory (RAM) of a computer to
        its persistent memory (HDD/SSD) as files with various formats:
      \item Most file formats include some sort of compression:
        \begin{itemize}
        \item Lossless compression (PNG): original values can be exactly retreived
        \item Lossy compression (JPEG): information is lost when storing the image
        \item Both (TIF): some formats are containers which can include various type of compression
        \end{itemize}
      \item ImageJ can read and write natively TIF, PNG, JPG
      \item Use TIF for saving intermediate results (with LZW compression) and PNG for figures
      \end{itemize}
    \end{column}
    \begin{column}{0.25\textwidth}
      \includegraphics[width=\textwidth]{drive}
    \end{column}
  \end{columns}

\end{frame}

\begin{frame}
  \frametitle{Microscope vendor image formats}
  Each microscopy company has developed a format that can store
  multiple series with each a multi-channel multi-plane image stack.
  \begin{itemize}
  \item Zeiss
    \begin{itemize}
    \item LSM : TIF based file format with additional metadata and LZW compression
    \item CZI : JPEG-XR and Zstd lossless compressed image
    \end{itemize}
  \item Nikon
    \begin{itemize}
    \item ND2 : JPEG-2000 lossless compression
    \end{itemize}
  \item Leica
    \begin{itemize}
    \item LIF : Customized TIF file format
    \end{itemize}
  \item Olympus
    \begin{itemize}
    \item OIF: multi file formats with associated images in a folder
    \item OIB: store multiple OIF and dependent image in one file
    \end{itemize}
  \end{itemize}
  Some standardized image format have also been developed to increase inter-operability:
  \begin{itemize}
  \item OME-TIFF, OME-ZARR, ICS, HDF5
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Loading an Image}
  \begin{itemize}
  \item Fiji will detect supported file format when selecting
    \menu{File>Open} and use bioformat if needed to load an image from disk to memory.
    \item You can also use directly the \menu{Plugins > Bio-Formats} menu to use bioformat
  \end{itemize}
\end{frame}



\begin{frame}
  \frametitle{Brightness \& Contrast adjustment}
  \begin{itemize}
  \item \menu{Image > Adjust > Brightness \& Contrast...} or \keys{\Alt+\shift+C} launches the B\&C tool
  \item Pixels intensities are mapped linearly to the displayed intensity.
  \item Enable to discard unused part of the dynamic range
  \item Adjust the Minimum and Maximum of the dynamic range which will be displayed.
  \item Adjust the Brightness and Contrast to change how they are display.
  \item Press \menu{Auto} to enchance contrast between a predefined percentage of saturated pixels. Equivalent to \menu{Process > Enhance Contrast...} with the normalized option left unticked.
  \item Press \menu{Apply} to change the pixel values.
  \item When changing the image mode (16-bit to 8-bit or 32-bit to
    8-bit) the B\&C settings are applied to the image.
  \end{itemize}
\end{frame}


\begin{frame}
  \frametitle{Multi-dimensional images}
  \framesubtitle{Stack \& Hyperstacks}
  \begin{itemize}
  \item
  \end{itemize}
\end{frame}


\begin{frame}
  \frametitle{Quantization}
  \begin{columns}
    \begin{column}{0.75\textwidth}
      \begin{itemize}
      \item The intensity values are quantized into grey levels

      \item Images are saved as 8-bit or 16-bit images on acquisition softwares.
      \item For camera sensor (CCD, CMOS), photo-electron are accumulated in wells and converted into analogue voltages that are then digitized. Well depth is in the order of ~40000 electrons.
      \item On confocal microscope, photo-multiplier tubes (PMT) collect electrons and amplify them using a chain of dynodes enabling to count individual photons.
      \end{itemize}
      \begin{itemize}
      \item Use \menu{Image>Type>8-bit} to check \& convert an image to 8-bit, using the current dynamic range.
      \end{itemize}
    \end{column}
    \begin{column}{0.25\textwidth}
      \begin{center} \small
        \rowcolors{1}{gray!25!bg}{white!25!bg}
        \begin{tabular}{cc}
          Bit depth & Dynamic range \\ \hline
          8  & 0-255 \\
          12 & 0-4095\\
          14 & 0-16383\\
          16 & 0-65535
        \end{tabular}
      \end{center}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Image integrity\footnote{\url{https://www.nature.com/nature-portfolio/editorial-policies/image-integrity#microscopy}}}
  When preparing the figure:
  \begin{itemize}
  \item Apply adjustments to the entire image
  \item Track the sequence of manipulations (scripts/macro)
  \item Disclose the use of nonlinear adjustment such as ``gamma''.
  \end{itemize}
  Include in the legend or methods section the following information:
  \begin{itemize}
  \item Equipment (microscopes/objective lenses, cameras, detectors, filters) and acquisition software used.
    %\begin{itemize}
    %\item[bad] Pictures were taken on the Zeiss\_780\_2S370.
    %\item[good] Images acquired on a Zeiss LSM 780 inverted microscope controlled by Zen black and equiped with a 63x/1.4 oil objective using a 488nm laser and GaAsp detectors.
    %\end{itemize}
  \item Time and space sampling (pixel size), image bit depth, temperature, imaging medium, fluorochromes
  \item Look up table.
  \item Processing software and manipulations (deconvolution, 3D reconstructions, volume rendering, filtering, thresholding and projection).
  \end{itemize}
  \cite{
\end{frame}



    Adjustments should be applied to the entire image. Threshold manipulation, expansion or contraction of signal ranges and the altering of high signals should be avoided. If "pseudo-colouring" and nonlinear adjustment (for example "gamma changes") are used, this must be disclosed. Adjustments of individual colour channels are sometimes necessary on "merged" images, but this should be noted in the figure legend.
    Cells from multiple fields should be grouped into a single field

We encourage inclusion of the following with the final revised version of the manuscript for publication:

    In the Methods, specify the type of equipment (microscopes/objective lenses, cameras, detectors, filter model and batch number) and acquisition software used. Although we appreciate that there is some variation between instruments, equipment settings for critical measurements should also be listed.
    We encourage deposition of raw image files (including relevant metadata for example: acquisition information, including time and space resolution data (xyzt and pixel dimensions); image bit depth; experimental conditions such as temperature and imaging medium; and fluorochromes (excitation and emission wavelengths or ranges, filters, dichroic beamsplitters, if any).
    The display lookup table (LUT) and the quantitative map between the LUT and the bitmap should be provided, especially when rainbow pseudocolor is used. If the LUT is linear and covers the full range of the data, that should be stated.
    Processing software should be named in the methods section and any manipulations indicated in the relevant figure legends (such as type of deconvolution, three-dimensional reconstructions, surface and volume rendering, "gamma changes," filtering, thresholding and projection).

Authors should state the measured resolution at which an image was acquired and any downstream processing or averaging that enhances the resolution of the image.

\end{document}
